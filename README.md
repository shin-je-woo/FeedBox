# FeedBox 서비스

## ✋ 프로젝트 소개

- 컨텐츠 발행 및 구독서비스입니다.
- 핵심 기능에 집중하기 위해 로그인과 같은 기본 기능은 생략합니다.
- 다른 팀과 협업한다고 가정합니다.

## ✋ 요구사항

- User는 컨텐츠를 발행한다.
- User는 다른 User를 구독할 수 있다. 구독자는 발행된 컨텐츠를 읽을 수 있다.
- 검색기능을 제공한다.

## ✋ 프로젝트 진행을 위한 Case 가정

- 컨텐츠 팀과 유저정보 팀이 있다.
- 컨텐츠는 내가 속한 팀이 관리하고, 유저정보는 다른 팀이 관리한다.
- 유저정보 팀은 유저 정보, 구독 정보, 카테고리 정보를 관리한다.
- 내가 속한 팀은 유저정보 팀의 REST API를 호출해서 유저정보를 가져온다.
  - 유저정보 팀API는 오류가 발생할 수 있다! (1초 지연 후 500Error)

## ✋ 개발 내역
1) 작성자가 컨텐츠를 발행한다.
  - 컨텐츠는 발행 즉시 Mysql에 데이터가 저장된다.
  - 작성된 콘텐츠는 Kafka에 produce 된다. (토픽 = feedbox.post.original)
2) 발행된 컨텐츠를 검수한다.
  - feedbox.post.original 토픽을 구독하던 Kafaka 컨슈머가 원본 컨텐츠를 consume한다.
  - 컨슈머는 메시지를 받아서 유저정보 팀서버에 카테고리 정보API를 요청한다. 
  - 카테고리 정보 + 원본 컨텐츠를 조합하고, Chat-GPT API를 호출해 카테고리, 컨텐츠 제목, 컨텐츠 내용을 검수한다.
  - 검수결과가 성공이면 검수된 컨텐츠를 Kafka에 produce한다. (토픽 = feedbox.post.inspected)
3) 검수완료된 컨텐츠를 구독함에 넣어준다.
  - feedbox.post.inspected 토픽을 구독하던 Kafka 컨슈머가 검수된 컨텐츠를 consume한다.
  - Kafka 메시지 안의 컨텐츠 ID로 유저정보 팀서버에 구독자 목록API를 요청한다.
  - 유저정보팀은 구독자 목록을 반환한다. (Case 가정에 따라 구독자 목록API는 20%확률로 실패한다.)
  - 검수된 컨텐츠, 구독자 정보를 조합해서 구독함(MongoDB)에 저장한다.
4) 구독함에서 컨텐츠 목록을 조회한다.
   - MySQL에서 컨텐츠 원본정보를 가져온다.
   - 구독함(MongoDB)에 저장된 검수된 컨텐츠, 구독자 정보를 가져온다.
   - 각 컨텐츠마다 유저정보 팀서버에 유저정보API, 카테고리 정보API를 호출해서 유저정보를 가져온다.
   - [개선] 유저정보 서버 API들은 20%확률로 1초 지연 후 500Error가 발생할 수 있기 때문에 가져온 정보는 Redis에 캐싱해두고 사용한다.
   - 컨텐츠 + 유저정보를 조합해서 구독자에게 목록으로 제공한다.
5) 컨텐츠를 조회한다.
  - MySQL에서 컨텐츠 원본정보를 가져온다.
  - 각 컨텐츠마다 유저정보 팀서버에 유저정보API, 카테고리 정보API를 호출해서 유저정보를 가져온다.
  - 컨텐츠 + 유저정보를 조합해서 구독자에게 제공한다.
  - [개선] 유저정보 서버 API들은 20%확률로 1초 지연 후 500Error가 발생할 수 있기 때문에 가져온 정보는 Redis에 캐싱해두고 사용한다.

## ✋ 궁금증

- 유저정보 API는 실패해도 Consumer Retry 정책으로 2초마다 재시도한다.
  - 재시도 5회가 초과되면 컨슈머는 DLT에 실패한 메시지를 발행한다. 
  - DLT에 발행된 이벤트는 어떻게 처리할까?